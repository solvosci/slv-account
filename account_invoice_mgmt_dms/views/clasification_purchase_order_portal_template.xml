<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- <template id="portal_layout" name="Portal layout: pricelist menu entry" inherit_id="portal.portal_breadcrumbs" priority="50">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'Pricelist'" t-attf-class="breadcrumb-item #{'active'}">
                <a t-attf-href="/my/purchase/pricelist">Pricelists</a>
            </li>
        </xpath>
    </template> -->
    <template
        id="portal_my_clasification_purchase_breadcrumbs"
        name="My Classification Purchase: Breadcrumbs"
        inherit_id="portal.portal_breadcrumbs"
    >
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <t t-if="page_name == 'classification_purchase'">
                <li t-attf-class="breadcrumb-item active">
                    <span>Classification Purchase</span>
                </li>
            </t>
            <t t-if="page_name == 'classification_purchase_id'">
                <li t-attf-class="breadcrumb-item">
                    <a href="/my/classification/purchase" title="Classification Purchase">Classification Purchase</a>
                </li>
                <li t-attf-class="breadcrumb-item active">
                    <span><t t-esc="item.name"/></span>
                </li>
            </t>
        </xpath>
    </template>

    <template id="portal_my_home_clasification_purchase" name="Portal My Home : Clasification Purchase" inherit_id="portal.portal_my_home" priority="20">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-if="classification_purchase_count" t-call="portal.portal_docs_entry">
                <t t-set="title">Classification Purchase</t>
                <t t-set="url" t-value="'/my/classification/purchase'"/>
                <t t-set="count" t-value="classification_purchase_count"/>
            </t>
        </xpath>
    </template>

    <template id="portal_my_clasification_purchase_tree" name="My Classification Purchase Tree">
        <t t-call="portal.portal_layout">
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Classification Purchase</t>
                <t t-set="url" t-value="'/my/classification/purchase/'"/>
            </t>
            <div class="table-responsive border rounded border-top-0 ">
                <table class="table rounded mb-0 bg-white o_portal_my_doc_table">
                    <thead>
                        <tr class="active">
                            <th>Name</th>
                            <th>Date</th>
                            <th class="text-right">Total</th>
                        </tr>
                    </thead>
                    <t t-foreach="items" t-as="order">
                        <tr>
                            <td>
                                <a t-attf-href="/my/classification/purchase/#{order.id}?#{keep_query()}">
                                    <t t-esc="order.name"/>
                                </a>
                            </td>
                            <td>
                                <t t-esc="order.date_approve"/>
                            </td>
                            <td class="text-right">
                                <span t-field="order.amount_total" t-options="{'widget': 'monetary', 'display_currency': order.currency_id}"/>
                            </td>
                        </tr>
                    </t>
                </table>
            </div>
        </t>
    </template>

    <template id="portal_my_clasification_purchase_form" name="My Classification Purchase Form">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Classification Purchase Items</t>
                <t t-set="url" t-value="'/my/classification/purchase/'"/>
            </t>
            <div class="container">
                <div class="card">
                    <div class="card-header">
                      <div class="row">
                        <div class="col-8">
                          <h4><t t-esc="item.name"/></h4>
                        </div>
                        <div class="col-4">
                            <div style="display: flex;justify-content: end;">
                                <button name="o_add_attachment_button" type="submit" class="btn btn-primary" data-toggle="modal" data-target="#add_purchase_file_attachment" data-icon-class="fa-chevron-right"> Add Attachment </button>
                                <div id="add_purchase_file_attachment" role="dialog" class="modal fade">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <form id="add_attachments" method="POST" action="/classification/purchase/add_attachment" class="modal-content" enctype="multipart/form-data">
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                <div class="modal-header">
                                                    <h2 class="modal-title">Upload files!</h2>
                                                </div>
                                                <div class="modal-body">
                                                    <input type="file" name="attachment" class="o_input_file" data-show-upload="true" data-show-caption="true" lass="file"/>
                                                    <input type="text" name="purchase_order" t-att-value="item.id" style="visibility: hidden;"/>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="submit" class="btn btn-primary" id="add_attachment">Upload</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row no-gutters mb-3">
                        <div class="col-6">
                            <div class="row no-gutters">
                                <div class="col-4">
                                    <span><b>Partner:</b></span>
                                </div>
                                <div class="col-8">
                                    <span><t t-esc="item.partner_id.name"/></span>
                                </div>
                            </div>
                            <div class="row no-gutters">
                                <div class="col-4">
                                    <span><b>Attachment:</b></span>
                                </div>
                                <div class="col-8">
                                    <t t-if="dms_file">
                                        <t t-foreach="dms_file" t-as="file">
                                            <a
                                                t-attf-href="/my/dms/file/#{file.id}/download?{{ keep_query() }}"
                                                t-attf-class="d-block tr_dms_file_link"
                                                t-att-title="file.name"
                                            >
                                                <span t-esc="file.name" />
                                            </a> 
                                        </t>
                                    </t>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row no-gutters">
                                <div class="col-4">
                                    <span><b>Confirm Date:</b></span>
                                </div>
                                <div class="col-8">
                                    <span><t t-esc="item.date_approve"/></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table-responsive border rounded border-top-0 mb-3">
                        <table class="table rounded mb-0 bg-white o_portal_my_doc_table">
                            <thead>
                                <tr class="active">
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th class="text-right">Subtotal</th>
                                </tr>
                            </thead>
                            <t t-foreach="item.order_line" t-as="line">
                                <tr>
                                    <td><t t-esc="line.product_id.name"/></td>
                                    <td><t t-esc="line.product_qty"/></td>
                                    <td class="text-right"><span t-field="line.price_subtotal" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></td>
                                </tr>
                            </t>
                        </table>
                    </div>
                    <div class="row no-gutters">
                        <div class="col-12">
                            <span class="text-right d-block"><b>Subtotal: </b><span t-field="item.amount_total" t-options="{'widget': 'monetary', 'display_currency': item.currency_id}"/></span>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
